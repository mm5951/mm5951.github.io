---
title: "Dashboard"
output: 
  html_document:
    toc: true
    toc_float: true
---

This dashboard analyses data from the NOAA package as part of a [Data Science p8105](https://p8105.com/index.html) class exercise.

## Background

The **National Oceanic and Atmospheric Association (NOAA)** of the National Centers for Environmental Information (NCEI) provides public access to some weather data, including the GHCN (Global Historical Climatology Network)-Daily database of summary statistics from weather stations around the world. More information on the adapted NOAA dataset for p8105 is available [here](https://p8105.com/dataset_noaa.html).

## Data wrangling

We're going to load required libraries for this project.

```{r, warning = FALSE, message = FALSE}
library(tidyverse)
library(p8105.datasets)
library(plotly)
```

Next, we'll concentrate on a subset of the NOAA data. The code below extracts the "ny_noaa" dataset and does some **data cleaning and wrangling** to generate the "noaa_df" including:

* Set reasonable names using `janitor::clean_names` function.
* Create separate variables for year, month, and day using `separate`.
* Coerce the right data type for temperature, precipitation, and snowfall observations using `mutate` in combination with `as.numeric`and similar arguments.
* Express the variables "prcp", "tmax" and "tmin" in easy to interpret units (that is, in mm and ºC, instead of tenths of such unit as in the original dataset). As a result of the `mutate` function, 3 new columns (prcp2, tmin2, tmax2) are generated.

In order to reduce the scope of the dataset (and therefore allow for better functioning of an online dashboard), using `filter` we'll select the data from the years between 2000 and 2010, and drop all the empty precipitation, snow and temperature records. Finally, using `sample_n()` we'll select a random sample of 5,000 observations.

```{r}
noaa_df = ny_noaa %>%
  janitor::clean_names() %>%
  separate(date, into = c("year", "month", "day"), sep = '-') %>%
  mutate(month = as.numeric(month),
         year = as.factor(year),
         month = month.abb[month],
         month = factor(month, levels = month.abb),
         tmax = as.numeric(tmax),
         tmin = as.numeric(tmin),
         prcp = as.numeric(prcp),
         snow = as.numeric(snow),
         prcp2 = prcp/10,
         tmax2 = tmax/10,
         tmin2 = tmin/10) %>% 
  filter(
    year %in% 2000:2010,
   !is.na(tmax),
   !is.na(tmin),
   !is.na(prcp),
   !is.na(snow)) %>% 
  sample_n(5000)
```

## Data visualization

The following interactive data visualizations (aka dashboard) are creating using `plot_ly`.

### Box plot: monthly maximum temperature

The following `plot_ly()`boxplot showcases the maximum temperature (ºC) per month, with different colors attributed to each weather station.

```{r}
max_temp = noaa_df %>%
  mutate(text_label = str_c("Tmax: ºC", tmax2, "\nTmin: ºC", tmin2),
         ) %>% 
  plot_ly(
    x = ~month, y = ~tmax2, type = "scatter", mode = "markers",
    color = ~id, text = ~text_label, alpha = 0.5, colors = "viridis")

max_temp
```

## Bar plot : 

Amount of snow fall days per year

```{r}
days_snow = noaa_df %>% 
  mutate(snow_day = if_else((snow == 0 | snow != 0),"no","yes")) %>% 
  count(snow) %>% 
  plot_ly(x = ~snow, y = ~n, color = ~id, type = "bar", colors = "viridis")

days_snow


noaa_df2 = noaa_df %>% 
  mutate(snow_day = if_else((snow == 0 | snow > 0),"no","yes"))
```

