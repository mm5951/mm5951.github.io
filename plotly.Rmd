---
title: "Dashboard"
output: 
  html_document:
    toc: true
    toc_float: true
---

This dashboard analyses data from the NOAA package as part of a [Data Science p8105](https://p8105.com/index.html) class exercise.

## Background

The **National Oceanic and Atmospheric Association (NOAA)** of the National Centers for Environmental Information (NCEI) provides public access to some weather data, including the GHCN (Global Historical Climatology Network)-Daily database of summary statistics from weather stations around the world. More information on the adapted NOAA dataset for p8105 is available [here](https://p8105.com/dataset_noaa.html).

## Data wrangling

We're going to load required libraries for this project.

```{r}
library(tidyverse)
library(p8105.datasets)
library(plotly)
```

Next, we'll concentrate on a subset of the NOAA data. The code below extracts the "ny_noaa" dataset and does some **data cleaning and wrangling** to generate the "noaa_df" including:

* Set reasonable names using `janitor::clean_names` function.
* Create separate variables for year, month, and day using `separate`.
* Coerce the right data type for temperature, precipitation, and snowfall observations using `mutate` in combination with `as.numeric`and similar arguments.
* Express the variables "prcp", "tmax" and "tmin" in easy to interpret units (that is, in mm and ºC, instead of tenths of such unit as in the original dataset). As a result of the `mutate` function, 3 new columns (prcp2, tmin2, tmax2) are generated.

In order to reduce the scope of the dataset (and therefore allow for better functioning of an online dashboard), using `filter` we'll select the data from the years between 2000 and 2010, and drop all the empty precipitation, snow and temperature records. Finally, using `sample_n()` we'll select a random sample of 5,000 observations.

```{r}
noaa_df = ny_noaa %>%
  janitor::clean_names() %>%
  separate(date, into = c("year", "month", "day"), sep = '-') %>%
  mutate(month = as.numeric(month),
         year = as.factor(year),
         month = month.abb[month],
         month = factor(month, levels = month.abb),
         tmax = as.numeric(tmax),
         tmin = as.numeric(tmin),
         prcp = as.numeric(prcp),
         prcp2 = prcp/10,
         tmax2 = tmax/10,
         tmin2 = tmin/10) %>% 
  filter(
    year %in% 2000:2010,
   !is.na(tmax),
   !is.na(tmin),
   !is.na(prcp),
   !is.na(snow)) %>% 
  sample_n(5000)

str(noaa_df)
skimr::skim(noaa_df)
```

## Data visualization

The following interactive data visualizations (aka dashboard) are creating using `plot_ly`.

### Line plot

Using  I make a **two-panel plot showing the average max temperature in January and in July** in each station across years. 

```{r}
max_temp = noaa_df %>%
  filter(month == "Jan" | month == "Jul") %>%  
  group_by(id, year, month) %>% 
  summarize(mean_temp = mean(tmax2, na.rm = TRUE)) %>%
  ggplot(aes(x = year, y = mean_temp, group = id)) +
  geom_line(aes(color = id)) +
  facet_grid(. ~ month) +
  labs(
    title = "Maximum temperature per station over time (January and July visualized)",
    x = "Time (years)",
    y = "Mean maximum temperature (ºC)",
    caption = "Exploratory analysis from the ny_noaa dataset") +
  theme(legend.position = "none")
max_temp
```

